import{d as A,O as R,o as g,f as w,b as t,a as e,ai as Z,R as ee,aj as ae,w as i,z as $,T as te,U as y,s as m,ak as oe,D as ie,a0 as B,a1 as v,a2 as d,al as ne,h as se,p as T,t as D,am as j,an as re,ao as le,X as E,Y as H,ap as K,c as S,aq as ue,C as q,ar as ce,as as de,k as me,F as pe,at as U,au as I,av as _,aw as fe,u as ye,m as ge,S as ve,ax as _e,ay as ke,az as Pe,aA as he,aB as O}from"./index-BxKZXudA.js";import{u as G}from"./AudioPlayerStore-ChypCQq6.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{g as be,c as Se,d as Ie,m as Te}from"./ChapterStore-BCWT5l7E.js";const Ce={class:"container"},De=A({__name:"VerseActionSheet",props:{verse:{},triggerProp:{},actionSheetButtonsProps:{}},emits:["update:didDismiss","update:playVerseAudio","update:bookmarked"],setup(C,{emit:n}){const a=R(!1),c=C,o=n,k=[{text:"Play",role:"play"},{text:"Copy",role:"copy"},{text:"Bookmark",role:"bookmark"},{text:"Cancel",role:"cancel"}],P=u=>{switch(u.detail.role){case"play":o("update:playVerseAudio",{audioID:c.verse.chapter_id,verseKey:c.verse.verse_key});break;case"copy":h(c.verse.text_uthmani);break;case"bookmark":o("update:bookmarked",c.verse.verse_number);break}},h=u=>{navigator.clipboard.writeText(u),a.value=!0};return(u,p)=>(g(),w("div",Ce,[t(e(Z),{trigger:u.triggerProp,header:"Verse ".concat(u.verse.verse_key),buttons:k,onDidDismiss:[p[0]||(p[0]=f=>u.$emit("update:didDismiss",f)),p[1]||(p[1]=f=>P(f))]},null,8,["trigger","header"])]))}}),Fe=A({__name:"AudioPlayerModalComponent",setup(C){const n=G(),a=u=>"".concat(u,"%"),c=()=>U.dismiss(null,"cancel"),o=R(),k=u=>{o.value&&(n.mediaVolume=u.detail.value,o.value.volume=n.mediaVolume/100)},P=()=>{o.value&&(o.value.currentTime=I(n.progressTimer),n.progressTimer=_(o.value.currentTime))},h=()=>{o.value&&(o.value.paused?(o.value.play(),n.isPlaying=!0):(o.value.pause(),n.isPlaying=!1))};return ee(()=>{o.value=document.querySelector("#audioPlayerRef")}),(u,p)=>{const f=ae("svg-icon");return g(),w(pe,null,[t(e(ie),null,{default:i(()=>[t(e($),null,{default:i(()=>[t(e(te),{slot:"start"},{default:i(()=>[t(e(y),{color:"medium",onClick:c},{default:i(()=>[t(e(m),{icon:e(oe)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),t(e(me),{class:"ion-padding ion-margin-vertical"},{default:i(()=>[t(e(B),null,{default:i(()=>[t(e(v),{class:"ion-justify-content-center"},{default:i(()=>[t(e(d),{size:"11"},{default:i(()=>[t(e(ne),{src:"/reciters/".concat(e(n).selectedReciter.reciter_id,".jpg"),alt:e(n).selectedReciter.name},null,8,["src","alt"])]),_:1})]),_:1}),t(e(v),{class:"ion-justify-content-center ion-margin-vertical"},{default:i(()=>[t(e(d),{size:"11"},{default:i(()=>[t(e(se),null,{default:i(()=>[T("h3",null,D(e(n).chapterName),1),T("h2",null,D(e(n).selectedReciter.name),1)]),_:1})]),_:1})]),_:1}),t(e(v),{class:"ion-justify-content-center ion-margin-vertical"},{default:i(()=>[t(e(d),{size:"12"},{default:i(()=>[t(e(j),{"aria-label":"Seek",color:"primary",onIonChange:P,pin:!0,"pin-formatter":a,value:e(n).progressTimer/1e3,min:0,max:e(n).duration},null,8,["value","max"])]),_:1})]),_:1}),t(e(v),{class:"ion-margin-vertical ion-justify-content-center"},{default:i(()=>[t(e(d),{size:"2"},{default:i(()=>[t(e(y),{fill:"clear"},{default:i(()=>[t(e(m),{icon:e(re),size:"large",color:"primary"},null,8,["icon"])]),_:1})]),_:1}),t(e(d),{size:"2"},{default:i(()=>[t(e(y),{fill:"clear",onClick:e(n).playPrevious},{default:i(()=>[t(e(m),{icon:e(le),size:"large",color:"primary"},null,8,["icon"])]),_:1},8,["onClick"])]),_:1}),t(e(d),{size:"2"},{default:i(()=>[t(e(y),{fill:"clear",onClick:h},{default:i(()=>[t(e(m),{icon:e(n).isPlaying?e(E):e(H),size:"large",color:"primary"},null,8,["icon"])]),_:1})]),_:1}),t(e(d),{size:"2"},{default:i(()=>[t(e(y),{fill:"clear",onClick:e(n).playNext},{default:i(()=>[t(e(m),{icon:e(K),size:"large",color:"primary"},null,8,["icon"])]),_:1},8,["onClick"])]),_:1}),t(e(d),{size:"2"},{default:i(()=>[e(n).loopAudio==="none"?(g(),S(e(y),{key:0,fill:"clear"},{default:i(()=>[t(f,{type:"mdi",path:e(ue),size:30},null,8,["path"])]),_:1})):q("",!0)]),_:1})]),_:1}),t(e(v),{class:"ion-justify-content-center ion-margin-vertical"},{default:i(()=>[t(e(d),{size:"12"},{default:i(()=>[t(e(j),{"aria-label":"Volume",onIonChange:k,pin:!0,"pin-formatter":a,value:e(n).mediaVolume*100},{default:i(()=>[t(e(m),{slot:"start",icon:e(ce)},null,8,["icon"]),t(e(m),{slot:"end",icon:e(de)},null,8,["icon"])]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})],64)}}}),Ae=Q(Fe,[["__scopeId","data-v-7a20fe24"]]),Re=["alt","src"],we={key:0},xe=["autoplay","src","type"],Ve=A({__name:"AudioPlayerComponent",emits:["update:modelValue"],setup(C,{emit:n}){const a=G(),c=fe(),o=R(),{getLocale:k}=ye(),P=n,h=async()=>{(await U.create({component:Ae})).present()},u=()=>{o.value&&(o.value.paused?(o.value.play(),a.isPlaying=!0):(o.value.pause(),a.isPlaying=!1))},p=()=>{var s;if((s=o.value)!=null&&s.buffered&&o.value.buffered.length){const r=o.value.buffered.length-1;return o.value.buffered.end(r)}return 0},f=()=>{o.value&&a.audioFiles&&(a.listenerActive=!0,a.currentTimestamp=o.value.currentTime,a.duration=I(a.audioFiles.duration),a.elapsedTime=O(a.duration-(a.currentTimestamp-1),be(k.value)),a.progressTimer=_(a.currentTimestamp-1))},x=async()=>{var s;switch(a.loopAudio){case"once":o.value&&(o.value.currentTime=0,a.isPlaying=!0,(s=o.value)==null||s.play());break;case"repeat":await a.playNext();break;case"none":a.isPlaying=!1,a.listenerActive=!1,V();break}},V=()=>{o.value&&(a.listenerActive=!1,a.isPlaying=!1,o.value.removeEventListener("timeupdate",f),o.value.removeEventListener("ended",x),o.value.removeEventListener("pause",a.playbackPaused),a.audioPlayerSetting.dismissOnEnd&&J())},W=()=>{a.audioFiles&&(a.audioDuration=O(Math.round(a.audioFiles.duration))),o.value&&(o.value.volume=a.mediaVolume)},X=()=>{var s;if(a.isLoading=!0,o.value)if(o.value.readyState>2){if(a.selectedVerseKey){const r=(s=a.audioFiles)==null?void 0:s.verse_timings.find(l=>l.verse_key===a.selectedVerseKey);r&&o.value&&(o.value.currentTime=I(r.timestamp_from),a.progressTimer=_(r.timestamp_from/r.timestamp_to))}a.isLoading=!1}else throw"Failed to fetch Audio"},z=()=>{o.value&&(o.value.currentTime=I(a.progressTimer),a.progressTimer=_(o.value.currentTime))},Y=()=>{a.chapterName&&(c.setPageTitle(a.chapterName),c.setMetaData([{property:"og:audio:title",content:a.chapterName},{name:"twitter:title",content:a.chapterName},{property:"og:title",content:a.chapterName}])),a.audioFiles&&c.setMetaData([{property:"music:song:track",content:String(a.audioFiles.id)},{property:"og:url",content:a.audioFiles.audio_url},{property:"og:type",content:a.audioFiles.format},{property:"og:audio",content:a.audioFiles.audio_url},{property:"music:duration",content:a.audioFiles.duration.toString()},{property:"og:audio:type",content:a.audioFiles.format}]),c.setMetaData([{name:"twitter:image",content:"/reciters/".concat(a.selectedReciter.reciter_id,".jpg")},{property:"music:musician",content:a.selectedReciter.name},{property:"og:audio:artist",content:a.selectedReciter.name},{property:"og:image",content:"/reciters/".concat(a.selectedReciter.reciter_id,".jpg")}]),"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:a.chapterName,artist:a.selectedReciter.name,album:"Quran",artwork:[{src:"/reciters/".concat(a.selectedReciter.reciter_id,".jpg"),sizes:"96x96",type:"image/jpg"}]}),navigator.mediaSession.setActionHandler("play",()=>{u()}),navigator.mediaSession.setActionHandler("pause",()=>{u()}),navigator.mediaSession.setActionHandler("seekto",({seekTime:s})=>{s&&(a.progressTimer=_(s),z())}),navigator.mediaSession.setActionHandler("nexttrack",()=>{a.playNext()}),navigator.mediaSession.setActionHandler("previoustrack",()=>{a.playPrevious()}))},L=(s,r,l)=>s>=r&&s<l,N=ge(()=>{if(a.audioFiles)return a.audioFiles.verse_timings.map(s=>({inRange:!1,wordLocation:"",wordPosition:0,verseNumber:0,...s}))});ve(()=>{var s;if(N){const r=Math.ceil(_(a.currentTimestamp)),l=(s=N.value)==null?void 0:s.find(F=>r>=F.timestamp_from&&r<=F.timestamp_to);l&&L(r,l.timestamp_from,l==null?void 0:l.timestamp_to)&&l.segments.map(b=>{const M=L(r,b[1],b[2]);if(M){a.verseTiming={chapterId:Se(l.verse_key),verseKey:l.verse_key,inRange:M,verseNumber:Ie(l.verse_key),wordLocation:Te(l.verse_key,b[0]),wordPosition:b[0],audioSrc:a.audioPayLoadSrc};return}})}}),_e(()=>{a.audioFiles=null});const J=()=>{o.value&&o.value.pause(),a.chapterId=0,a.selectedVerseKey="",V(),P("update:modelValue",!1)};return(s,r)=>(g(),S(e(he),null,{default:i(()=>[t(e($),null,{default:i(()=>[t(e(B),null,{default:i(()=>[t(e(v),null,{default:i(()=>[t(e(d),{onClick:h,size:"6"},{default:i(()=>[t(e(ke),null,{default:i(()=>[T("img",{alt:e(a).selectedReciter.name,src:"/reciters/".concat(e(a).selectedReciter.reciter_id,".jpg")},null,8,Re)]),_:1})]),_:1}),t(e(d),{class:"ion-text-right"},{default:i(()=>[t(e(y),{fill:"clear",onClick:u},{default:i(()=>[e(a).isLoading?(g(),S(e(Pe),{key:0})):(g(),S(e(m),{key:1,icon:e(a).isPlaying?e(E):e(H)},null,8,["icon"]))]),_:1}),t(e(y),{fill:"clear",onClick:e(a).playNext},{default:i(()=>[t(e(m),{icon:e(K)},null,8,["icon"])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1}),e(a).audioFiles?(g(),w("div",we,[T("audio",{controls:"",autoplay:e(a).audioPlayerSetting.autoPlay,ref_key:"audioPlayerRef",ref:o,id:"audioPlayerRef",class:"d-none",src:e(a).audioFiles.audio_url,type:"audio/".concat(e(a).audioFiles.format),onPause:r[0]||(r[0]=(...l)=>e(a).playbackPaused&&e(a).playbackPaused(...l)),onPlaying:r[1]||(r[1]=(...l)=>e(a).playbackPlaying&&e(a).playbackPlaying(...l)),onEnded:x,onCanplaythrough:W,onTimeupdate:f,onLoadeddata:X,onProgress:p,onLoadedmetadata:Y,onSeek:z},null,40,xe)])):q("",!0)]),_:1}))}}),je=Q(Ve,[["__scopeId","data-v-478cb891"]]);export{je as A,De as _};
