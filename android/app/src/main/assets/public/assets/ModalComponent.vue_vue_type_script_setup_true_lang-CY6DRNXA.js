import{aw as Be,z as e,A as q,P as z,as as ne,C as De,av as Te,u as Ce,d as Ae,o as m,c as A,w as c,b as p,a as o,$ as Pe,Z as Re,k as V,t as H,aG as Fe,ab as Le,v as x,aH as Ne,a2 as Ee,f as R,F as K,r as M,I as Y,R as ee,g as ae,b4 as te,i as oe,j as le,m as Oe,aV as $e}from"./index-CJnewdVb.js";import{i as U,u as Ve,A as He,e as ze,r as Ke}from"./ChapterStore-CS45AkxF.js";import{a as se}from"./string-BRzLPHJq.js";const Me=()=>({encodeBlobToBase64:h=>new Promise((r,d)=>{const v=new FileReader;v.onerror=d,v.onload=()=>{r(v.result)},v.readAsDataURL(h)}),decodeBase64toBlob:async h=>await U({method:"GET",baseURL:"",responseType:"blob",url:h})}),Je=Be("audio-player-store",()=>{const{getChapterNameByChapterId:S,TOTAL_CHAPTERS:P,getChapter:h}=Ve(),r=e(!1),d=q("__settingsDB"),v=q("__audioDB"),{encodeBlobToBase64:L}=Me(),l=e(null),B=e(!1),n=e(),D=e(""),T=e(""),i=e(),k=e(["0.25","0.5","0.75","Normal","1.25","1.5","1.75","2"]),I=e([]),s=e(),t=e(!1),u=e("Normal"),f=e(!1),ie=e(0),ue=e("00:00"),re=e(""),ce=e(0),de=e(1),W=e(!1),ve=e(!1),fe=e("none"),me=e(),ye=e(0),ge=e({fullwidth:!1,autoPlay:!0,dismissOnEnd:!0,autoScroll:!0,tooltip:!1}),J=z(()=>{if(n.value){const a=S(n.value);if(a)return a.nameSimple}}),N=async(a,y)=>{var E,C;if(i.value){const _=await v.getStorage("".concat(i.value.id,"-").concat(a.audioID));if(_){l.value={..._,verse_timings:JSON.parse(_.verse_timings)};return}const g=h(a.audioID);if(n.value=a.audioID,T.value=a.verseKey,D.value=a.audioSrc?a.audioSrc:y,((E=g==null?void 0:g.audioFile)==null?void 0:E.reciterId)===i.value.id&&(g==null?void 0:g.audioFile.chapter_id)===a.audioID){l.value=g.audioFile;return}r.value=!0,await U.get(ze((C=i.value)==null?void 0:C.id,a.audioID)).then(w=>{var O,$;l.value=null,s.value=void 0,l.value={reciterId:(O=i.value)==null?void 0:O.id,...w.data.audio_files[0]},g&&(g.audioFile={reciterId:($=i.value)==null?void 0:$.id,...w.data.audio_files[0]})}).catch(w=>{throw w}).finally(async()=>{r.value=!1,(await d.getStorage("audioSettings")).autoDownload&&Z()})}},j=async()=>{await U.get(Ke).then(a=>{I.value=a.data.reciters}).catch(a=>{throw a})},pe=async a=>{var y;i.value=a,n.value?await N({audioID:n.value}):await N({audioID:Number((y=l.value)==null?void 0:y.chapter_id)})},he=async a=>{n.value&&(n.value=n.value>=P?1:n.value+1,await N({audioID:n.value},a))},ke=async()=>{n.value&&(n.value=n.value-1,await N({audioID:n.value}))};ne(async()=>{await j()}),De(()=>{if(!i.value){const a=I.value.find(y=>y.reciter_id===6);a&&(i.value=a)}});const _e=z(()=>{if(I.value)return I.value.reduce((a,y)=>((a[y.style.name]=a[y.style.name]||[]).push(y),a),{})}),Se=z(()=>{if(i.value){const a=i.value.name.split(" ");return a[0].charAt(0)+a[1].charAt(0)}}),Ie=z(()=>{var a;return"".concat(He,'?name="').concat((a=i.value)==null?void 0:a.name)}),we=()=>{W.value=!1,f.value=!1},be=()=>{W.value=!0,f.value=!0},Z=()=>{if(l.value){const a=l.value.audio_url,y="".concat(String(l.value.reciterId),"-").concat(l.value.chapter_id);U.get(a,{responseType:"blob"}).then(async E=>{var _,g,w,O,$,Q,X;const C=await L(E.data);v.setStorage(y,{reciterId:String((_=l.value)==null?void 0:_.reciterId),id:(g=l.value)==null?void 0:g.id,chapter_id:(w=l.value)==null?void 0:w.chapter_id,file_size:(O=l.value)==null?void 0:O.file_size,format:($=l.value)==null?void 0:$.format,duration:(Q=l.value)==null?void 0:Q.duration,verse_timings:JSON.stringify((X=l.value)==null?void 0:X.verse_timings),audio_url:C})}).finally(async()=>{var C,_;t.value=!0,await(await Te.create({header:(C=i.value)==null?void 0:C.name,subHeader:(_=i.value)==null?void 0:_.style.name,message:J.value+" File has been downloaded!",buttons:["Ok"]})).present()})}};return{audioFiles:l,isLoading:r,playbackSpeeds:k,selectedReciter:i,recitations:I,chapterName:J,chapterId:n,autoStartPlayer:B,selectedVerseKey:T,mapRecitions:_e,verseTiming:s,audioPayLoadSrc:D,getReciterNameInitials:Se,avatarPlaceholder:Ie,playbackRate:u,listenerActive:f,progressTimer:ie,elapsedTime:ue,audioDuration:re,duration:ce,mediaVolume:de,isPlaying:W,isMuted:ve,loopAudio:fe,audioBuffer:me,currentTimestamp:ye,audioPlayerSetting:ge,playbackPlaying:be,playbackPaused:we,getRecitations:j,getAudio:N,getRecition:pe,playNext:he,playPrevious:ke,downloadAudioFile:Z}}),G=e("auto"),F=e({autoPlay:!0,dismissOnEnd:!0,autoScroll:!0,autoDownload:!1}),b=e({fontSize:"1",fontFamily:"noto-Kufi",fontWeight:"normal"}),je=()=>{const{getLine:S,setLocale:P,supportedLocales:h}=Ce(),{getStorage:r,setStorage:d}=q("__settingsDB"),v=e([{key:"dark",value:S("settings.dark")},{key:"light",value:S("settings.light")},{key:"auto",value:S("settings.auto")}]),L=e([{key:"amiri",value:"Amiri"},{key:"noto-kufi",value:"Noto-Kufi"},{key:"hafs-nastaleeq",value:"Hafs-Nastaleeq"},{key:"uthman-taha-naskh",value:"Uthman-Taha-Naskh"}]),l=e([{key:"normal",value:"Normal"},{key:"medium",value:"Medium"},{key:"semibold",value:"Semi Bold"},{key:"bold",value:"Bold"},{key:"extra-bold",value:"Extra Bold"}]),B=z(()=>"1.2.1"),n=s=>{const t=s.detail.value;document.documentElement.classList.toggle("ion-palette-dark",t==="dark"),G.value=t,d("colorScheme",t)},D=async s=>{b.value.fontSize=s.detail.value,await d("styles",b)},T=s=>{b.value.fontFamily=s.detail.value,d("styles",b)},i=s=>{b.value.fontWeight=s.detail.value,d("styles",b)},k=s=>{const t=s.detail;t.value==="autoPlay"?F.value.autoPlay=t.checked:t.value==="dismissOnEnd"?F.value.dismissOnEnd=t.checked:t.value==="autoScroll"&&(F.value.autoScroll=t.checked),d("audio",F)},I=s=>{const t=s.detail.value;h.value.map(f=>f.key).includes(t.key)&&(P(t.key,t.rtl),d("locale",{key:t.key,rtl:t.rtl}))};return ne(async()=>{const s=await r("styles");s&&(b.value=s);const t=await r("audioSettings");t&&(F.value=t);const u=await r("colorScheme");u&&(G.value=u)}),{colorScheme:G,colorSchemes:v,appVersion:B,audioSettings:F,styles:b,fontWeights:l,fontFamilyGroup:L,appleColorScheme:n,applyFontSize:D,applyFontFamily:T,applyFontWeight:i,handleAudioSetting:k,updateSelectedLocale:I}},Ue={key:0},We={key:1},Ze=Ae({__name:"ModalComponent",props:{title:{},trigger:{},data:{},selected:{}},emits:["update:selectedRecition","update:selectedTranslation"],setup(S,{emit:P}){const h=e(),r=S,d=P,v=()=>h.value.$el.dismiss(null,"cancel"),L=k=>{d("update:selectedRecition",k),v()},l=k=>{d("update:selectedTranslation",k),v()},B=e(),n=e(),D=e(),T=e(),i=()=>{r.trigger==="reciters-modal"?(B.value=r.data,D.value=r.selected):(n.value=r.data,T.value=r.selected)};return(k,I)=>(m(),A(o($e),{ref_key:"modal",ref:h,trigger:k.trigger,"can-dismiss":!0,onIonModalWillPresent:i},{default:c(()=>[p(o(Ee),null,{default:c(()=>[p(o(Pe),null,{default:c(()=>[p(o(Re),null,{default:c(()=>[V(H(k.title),1)]),_:1}),p(o(Fe),{slot:"start"},{default:c(()=>[p(o(Le),{onClick:v,color:"medium"},{default:c(()=>[p(o(x),{icon:o(Ne)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),p(o(Oe),{class:"ion-padding"},{default:c(()=>[B.value?(m(),R("div",Ue,[(m(!0),R(K,null,M(B.value,(s,t)=>(m(),A(o(Y),{key:t},{default:c(()=>[p(o(ee),null,{default:c(()=>[V(H(o(se)(t)),1)]),_:2},1024),(m(!0),R(K,null,M(s,u=>(m(),A(o(ae),{button:"",key:u.id,onClick:f=>L(u)},{default:c(()=>{var f;return[(u==null?void 0:u.id)===((f=D.value)==null?void 0:f.id)?(m(),A(o(x),{key:0,icon:o(te),color:"primary"},null,8,["icon"])):oe("",!0),p(o(le),null,{default:c(()=>[V(H(u.name),1)]),_:2},1024)]}),_:2},1032,["onClick"]))),128))]),_:2},1024))),128))])):(m(),R("div",We,[(m(!0),R(K,null,M(n.value,(s,t)=>(m(),A(o(Y),{key:t},{default:c(()=>[p(o(ee),null,{default:c(()=>[V(H(o(se)(t)),1)]),_:2},1024),(m(!0),R(K,null,M(s,u=>(m(),A(o(ae),{button:"",key:u.id,onClick:f=>l(u)},{default:c(()=>{var f;return[u.id===((f=T.value)==null?void 0:f.id)?(m(),A(o(x),{key:0,icon:o(te),color:"primary"},null,8,["icon"])):oe("",!0),p(o(le),null,{default:c(()=>[V(H(u.author_name),1)]),_:2},1024)]}),_:2},1032,["onClick"]))),128))]),_:2},1024))),128))]))]),_:1})]),_:1},8,["trigger"]))}});export{Ze as _,je as a,Je as u};
