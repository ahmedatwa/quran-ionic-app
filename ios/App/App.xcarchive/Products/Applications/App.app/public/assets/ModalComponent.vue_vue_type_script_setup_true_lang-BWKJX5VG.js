import{ax as Be,A as e,B as G,Q as V,at as ne,D as De,aw as Te,u as Ae,d as Ce,o as m,c as C,w as c,b as p,a as o,a1 as Pe,$ as Fe,k as H,t as U,aH as Le,ad as Re,v as x,aI as Ne,a4 as Ee,f as F,F as K,r as M,I as Z,S as ee,g as ae,b3 as te,i as oe,j as le,m as Oe,aU as $e}from"./index-CSnR3WyL.js";import{i as z,u as He,A as Ue,e as Ve,r as Ke}from"./ChapterStore-BzKdIpaO.js";import{a as se}from"./string-BRzLPHJq.js";const Me=()=>({encodeBlobToBase64:h=>new Promise((r,d)=>{const v=new FileReader;v.onerror=d,v.onload=()=>{r(v.result)},v.readAsDataURL(h)}),decodeBase64toBlob:async h=>await z({method:"GET",baseURL:"",responseType:"blob",url:h})}),Je=Be("audio-player-store",()=>{const{getChapterNameByChapterId:S,TOTAL_CHAPTERS:P,getChapter:h}=He(),r=e(!1),d=G("__settingsDB"),v=G("__audioDB"),{encodeBlobToBase64:R}=Me(),l=e(null),B=e(!1),n=e(),D=e(""),T=e(""),i=e(),k=e(["0.25","0.5","0.75","Normal","1.25","1.5","1.75","2"]),I=e([]),s=e(),t=e(!1),u=e("Normal"),f=e(!1),ie=e(0),ue=e("00:00"),re=e(""),ce=e(0),de=e(1),W=e(!1),ve=e(!1),fe=e("none"),me=e(),ye=e(0),ge=e({fullwidth:!1,autoPlay:!0,dismissOnEnd:!0,autoScroll:!0,tooltip:!1}),J=V(()=>{if(n.value){const a=S(n.value);if(a)return a.nameSimple}}),N=async(a,y)=>{var E,A;if(i.value){const _=await v.getStorage("".concat(i.value.id,"-").concat(a.audioID));if(_){l.value={..._,verse_timings:JSON.parse(_.verse_timings)};return}const g=h(a.audioID);if(n.value=a.audioID,T.value=a.verseKey,D.value=a.audioSrc?a.audioSrc:y,((E=g==null?void 0:g.audioFile)==null?void 0:E.reciterId)===i.value.id&&(g==null?void 0:g.audioFile.chapter_id)===a.audioID){l.value=g.audioFile;return}r.value=!0,await z.get(Ve((A=i.value)==null?void 0:A.id,a.audioID)).then(w=>{var O,$;l.value=null,s.value=void 0,l.value={reciterId:(O=i.value)==null?void 0:O.id,...w.data.audio_files[0]},g&&(g.audioFile={reciterId:($=i.value)==null?void 0:$.id,...w.data.audio_files[0]})}).catch(w=>{throw w}).finally(async()=>{r.value=!1,(await d.getStorage("audioSettings")).autoDownload&&Q()})}},j=async()=>{await z.get(Ke).then(a=>{I.value=a.data.reciters}).catch(a=>{throw a})},pe=async a=>{var y;i.value=a,n.value?await N({audioID:n.value}):await N({audioID:Number((y=l.value)==null?void 0:y.chapter_id)})},he=async a=>{n.value&&(n.value=n.value>=P?1:n.value+1,await N({audioID:n.value},a))},ke=async()=>{n.value&&(n.value=n.value-1,await N({audioID:n.value}))};ne(async()=>{await j()}),De(()=>{if(!i.value){const a=I.value.find(y=>y.reciter_id===6);a&&(i.value=a)}});const _e=V(()=>{if(I.value)return I.value.reduce((a,y)=>((a[y.style.name]=a[y.style.name]||[]).push(y),a),{})}),Se=V(()=>{if(i.value){const a=i.value.name.split(" ");return a[0].charAt(0)+a[1].charAt(0)}}),Ie=V(()=>{var a;return"".concat(Ue,'?name="').concat((a=i.value)==null?void 0:a.name)}),we=()=>{W.value=!1,f.value=!1},be=()=>{W.value=!0,f.value=!0},Q=()=>{if(l.value){const a=l.value.audio_url,y="".concat(String(l.value.reciterId),"-").concat(l.value.chapter_id);z.get(a,{responseType:"blob"}).then(async E=>{var _,g,w,O,$,X,Y;const A=await R(E.data);v.setStorage(y,{reciterId:String((_=l.value)==null?void 0:_.reciterId),id:(g=l.value)==null?void 0:g.id,chapter_id:(w=l.value)==null?void 0:w.chapter_id,file_size:(O=l.value)==null?void 0:O.file_size,format:($=l.value)==null?void 0:$.format,duration:(X=l.value)==null?void 0:X.duration,verse_timings:JSON.stringify((Y=l.value)==null?void 0:Y.verse_timings),audio_url:A})}).finally(async()=>{var A,_;t.value=!0,await(await Te.create({header:(A=i.value)==null?void 0:A.name,subHeader:(_=i.value)==null?void 0:_.style.name,message:J.value+" File has been downloaded!",buttons:["Ok"]})).present()})}};return{audioFiles:l,isLoading:r,playbackSpeeds:k,selectedReciter:i,recitations:I,chapterName:J,chapterId:n,autoStartPlayer:B,selectedVerseKey:T,mapRecitions:_e,verseTiming:s,audioPayLoadSrc:D,getReciterNameInitials:Se,avatarPlaceholder:Ie,playbackRate:u,listenerActive:f,progressTimer:ie,elapsedTime:ue,audioDuration:re,duration:ce,mediaVolume:de,isPlaying:W,isMuted:ve,loopAudio:fe,audioBuffer:me,currentTimestamp:ye,audioPlayerSetting:ge,playbackPlaying:be,playbackPaused:we,getRecitations:j,getAudio:N,getRecition:pe,playNext:he,playPrevious:ke,downloadAudioFile:Q}}),q=e("auto"),L=e({autoPlay:!0,dismissOnEnd:!0,autoScroll:!0,autoDownload:!1}),b=e({fontSize:"1",fontFamily:"noto-Kufi",fontWeight:"normal"}),je=()=>{const{getLine:S,setLocale:P,supportedLocales:h}=Ae(),{getStorage:r,setStorage:d}=G("__settingsDB"),v=e([{key:"dark",value:S("settings.dark")},{key:"light",value:S("settings.light")},{key:"auto",value:S("settings.auto")}]),R=e([{key:"amiri",value:"Amiri"},{key:"noto-kufi",value:"Noto-Kufi"},{key:"hafs-nastaleeq",value:"Hafs-Nastaleeq"},{key:"uthman-taha-naskh",value:"Uthman-Taha-Naskh"}]),l=e([{key:"normal",value:"Normal"},{key:"medium",value:"Medium"},{key:"semibold",value:"Semi Bold"},{key:"bold",value:"Bold"},{key:"extra-bold",value:"Extra Bold"}]),B=V(()=>"1.1.0"),n=s=>{const t=s.detail.value;document.documentElement.classList.toggle("ion-palette-dark",t==="dark"),q.value=t,d("colorScheme",t)},D=async s=>{b.value.fontSize=s.detail.value,await d("styles",b)},T=s=>{b.value.fontFamily=s.detail.value,d("styles",b)},i=s=>{b.value.fontWeight=s.detail.value,d("styles",b)},k=s=>{const t=s.detail;t.value==="autoPlay"?L.value.autoPlay=t.checked:t.value==="dismissOnEnd"?L.value.dismissOnEnd=t.checked:t.value==="autoScroll"&&(L.value.autoScroll=t.checked),d("audio",L)},I=s=>{const t=s.detail.value;h.value.map(f=>f.key).includes(t.key)&&(P(t.key,t.rtl),d("locale",{key:t.key,rtl:t.rtl}))};return ne(async()=>{const s=await r("styles");s&&(b.value=s);const t=await r("audioSettings");t&&(L.value=t);const u=await r("colorScheme");u&&(q.value=u)}),{colorScheme:q,colorSchemes:v,appVersion:B,audioSettings:L,styles:b,fontWeights:l,fontFamilyGroup:R,appleColorScheme:n,applyFontSize:D,applyFontFamily:T,applyFontWeight:i,handleAudioSetting:k,updateSelectedLocale:I}},ze={key:0},We={key:1},Qe=Ce({__name:"ModalComponent",props:{title:{},trigger:{},data:{},selected:{}},emits:["update:selectedRecition","update:selectedTranslation"],setup(S,{emit:P}){const h=e(),r=S,d=P,v=()=>h.value.$el.dismiss(null,"cancel"),R=k=>{d("update:selectedRecition",k),v()},l=k=>{d("update:selectedTranslation",k),v()},B=e(),n=e(),D=e(),T=e(),i=()=>{r.trigger==="reciters-modal"?(B.value=r.data,D.value=r.selected):(n.value=r.data,T.value=r.selected)};return(k,I)=>(m(),C(o($e),{ref_key:"modal",ref:h,trigger:k.trigger,"can-dismiss":!0,onIonModalWillPresent:i},{default:c(()=>[p(o(Ee),null,{default:c(()=>[p(o(Pe),null,{default:c(()=>[p(o(Fe),null,{default:c(()=>[H(U(k.title),1)]),_:1}),p(o(Le),{slot:"start"},{default:c(()=>[p(o(Re),{onClick:v,color:"medium"},{default:c(()=>[p(o(x),{icon:o(Ne)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),p(o(Oe),{class:"ion-padding"},{default:c(()=>[B.value?(m(),F("div",ze,[(m(!0),F(K,null,M(B.value,(s,t)=>(m(),C(o(Z),{key:t},{default:c(()=>[p(o(ee),null,{default:c(()=>[H(U(o(se)(t)),1)]),_:2},1024),(m(!0),F(K,null,M(s,u=>(m(),C(o(ae),{button:"",key:u.id,onClick:f=>R(u)},{default:c(()=>{var f;return[(u==null?void 0:u.id)===((f=D.value)==null?void 0:f.id)?(m(),C(o(x),{key:0,icon:o(te),color:"primary"},null,8,["icon"])):oe("",!0),p(o(le),null,{default:c(()=>[H(U(u.name),1)]),_:2},1024)]}),_:2},1032,["onClick"]))),128))]),_:2},1024))),128))])):(m(),F("div",We,[(m(!0),F(K,null,M(n.value,(s,t)=>(m(),C(o(Z),{key:t},{default:c(()=>[p(o(ee),null,{default:c(()=>[H(U(o(se)(t)),1)]),_:2},1024),(m(!0),F(K,null,M(s,u=>(m(),C(o(ae),{button:"",key:u.id,onClick:f=>l(u)},{default:c(()=>{var f;return[u.id===((f=T.value)==null?void 0:f.id)?(m(),C(o(x),{key:0,icon:o(te),color:"primary"},null,8,["icon"])):oe("",!0),p(o(le),null,{default:c(()=>[H(U(u.author_name),1)]),_:2},1024)]}),_:2},1032,["onClick"]))),128))]),_:2},1024))),128))]))]),_:1})]),_:1},8,["trigger"]))}});export{Qe as _,je as a,Je as u};
